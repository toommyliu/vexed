<style>
	html,
	body {
		height: 100%;
		width: 100%;
		margin: 0;
		overflow: hidden;
	}

	#swf {
		width: 100%;
		height: 100%;
	}

	#progress-container {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background-color: black;
		display: flex;
		justify-content: center;
		align-items: center;
	}

	#progress {
		width: 75%;
	}
</style>

<script src="jsapi/ItemBase.js"></script>
<script src="jsapi/Faction.js"></script>
<script src="jsapi/Quest.js"></script>
<script src="jsapi/Avatar.js"></script>
<script src="jsapi/Monster.js"></script>

<script src="jsapi/Auth.js"></script>
<script src="jsapi/Bank.js"></script>
<script src="jsapi/Bot.js"></script>
<script src="jsapi/Combat.js"></script>
<script src="jsapi/Drops.js"></script>
<script src="jsapi/Flash.js"></script>
<script src="jsapi/House.js"></script>
<script src="jsapi/Inventory.js"></script>
<script src="jsapi/Packet.js"></script>
<script src="jsapi/Player.js"></script>
<script src="jsapi/Quests.js"></script>
<script src="jsapi/Server.js"></script>
<script src="jsapi/Settings.js"></script>
<script src="jsapi/Shop.js"></script>
<script src="jsapi/TempInventory.js"></script>
<script src="jsapi/World.js"></script>

<script src="ipc/flash-ipc.js"></script>
<script src="ipc/ipc.js"></script>

<script>
	window.addEventListener('DOMContentLoaded', () => {
		var script = document.createElement('script');
		script.textContent = `
			var bot=Bot.getInstance();
			var auth=bot.auth;
			var bank=bot.bank;
			var combat=bot.combat;
			var drops=bot.drops;
			var flash=bot.flash;
			var house=bot.house;
			var inventory=bot.inventory;
			var packets=bot.packets;
			var player=bot.player;
			var quests=bot.quests;
			var settings=bot.settings;
			var shops=bot.shops;
			var tempInventory=bot.tempInventory;
			var world=bot.world;
		`;
		document.body.appendChild(script);
	});
</script>

<script>
	var { ipcRenderer } = require('electron');
	window.addEventListener('keydown', (event) => {
		switch (event.key) {
			// Allow the game to be closed whilst the game is focused
			case 'q': {
				if (event.metaKey) {
					// ipcRenderer.invoke("gameQuit");
				}
				break;
			}
			case 'PageUp':
				ipcRenderer.invoke("loadScript");
				break;
		}
	});
	window.addEventListener('DOMContentLoaded', () => {
		var div = document.createElement('div');
		div.id = 'progress-container';
		document.body.appendChild(div);

		var progress = document.createElement('progress');
		progress.id = 'progress';
		progress.max = "100";
		progress.value = "0";
		document.getElementById('progress-container').appendChild(progress);
	});

	async function progress([percentage]) {
		var progress = document.getElementById('progress');
		progress.value = percentage.toString();

		if (percentage === 100) {
			var progressContainer = document.getElementById('progress-container');
			progress?.remove();
			progressContainer?.remove();

			if (window?.account) {
				const { username, password, server } = window.account;
				const bot = Bot.getInstance();
				await bot.sleep(1000);
				await auth.login(username, password);
				if (server !== "None") {
					await bot.waitUntil(() => auth?.servers?.length > 0);
					await bot.sleep(250);
					await auth.connect(server);
					await bot.sleep(1000);
				}
				delete window.account;
			}
		}
	}
</script>

<embed id="swf" src="grimoire.swf" type="application/x-shockwave-flash" allowScriptAccess="always"
	quality="low"></embed>