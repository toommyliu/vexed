<!doctype html>
<html data-bs-theme="dark">

<link href="../../shared/bootstrap.css" rel="stylesheet">

<script>window.$ = window.jQuery = require("../../shared/jquery.js");</script>

<div class="container-fluid">
    <div class="row gap-4">
        <div class="col-md-6" style="width: 300px;">
            <div class="border p-3">
                <div class="d-flex flex-column mr-4">
                    <label>goto player</label>
                    <div class="d-flex flex-row gap-2">
                        <input id="player" class="form-control" type="text">
                        <div class="input-group-append">
                            <button class="w3-button border" id="me">me</button>
                        </div>
                    </div>
                    <label class="mt-3">skill set</label>
                    <input id="skills" class="form-control" type="text" value="1,2,3,4">
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="border p-3">
                <div class="form-check">
                    <input type="checkbox" id="start" class="form-check-input">
                    <label for="start" class="form-check-label">Start</label>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const { ipcRenderer: ipc } = require("electron");

    const parent = window.opener;

    $(() => {
        $(window).on("message", (event) => {
            console.log("Received message", event.originalEvent.data);

            const ev = event.originalEvent;

            switch (ev?.data?.event) {
                case 'tools:maid:me':
                    $('#player').val(ev.data.resp ?? '');
                    break;
            }
        });

        setTimeout(() => {
            if (!window.id) {
                console.log("Looks like we don't have an ID, dispatching a request from parent.");
                parent.postMessage({ event: "packets:generate_id" }, "*");
            }
        }, 500);

        $("#me").click(function () {
            parent.postMessage({ event: "tools:maid:me" }, "*");
        });

        $("#start").click(function () {
            if ($(this).prop("checked")) {
                parent.postMessage({
                    event: "tools:maid:start",
                    player: $("#player").val(),
                    skill_set: $("#skills").val()
                }, "*");
            } else {
                parent.postMessage({
                    event: "tools:maid:stop"
                }, "*");
            }
        });
    });
</script>

</html>