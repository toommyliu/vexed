<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<script>
	// https://github.com/electron/electron/issues/254
	window.$ = window.jQuery = require("../../shared/jquery.js");
</script>

<body class="w3-container">
	<button class="w3-button w3-border" id="load-script">load script</button>
</body>

<script>
	const { ipcRenderer: ipc } = require("electron");
	const parent = window.opener;

	$(document).ready(function ()
	{
		$(window).on("message", function (event)
		{
			// console.log("Received message", event.originalEvent.data);

			const ev = event.originalEvent;

			switch (ev?.data?.event)
			{
				case "scripts:generate_id": {
					window.id = ev.data.resp;
					console.log(`Your shared ID is: "${window.id}"`);
					break;
				}
			}
		});

		setTimeout(function ()
		{
			if (!window.id)
			{
				console.log("Looks like we don't have an ID, dispatching a request from parent.");
				parent.postMessage({ event: "scripts:generate_id" }, "*");
			}
		}, 500);

		$("#load-script").click(async function ()
		{
			await ipc.invoke("game:load_script", window.id).catch(() => null);
		});
	});
</script>