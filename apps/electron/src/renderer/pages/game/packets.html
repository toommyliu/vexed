<!doctype html>

<link href="../../shared/halfmoon.css" rel="stylesheet">
<script src="../../shared/bootstrap.js"></script>
<script>
	// https://github.com/electron/electron/issues/254
	window.$ = window.jQuery = require("../..//shared/jquery.js");
</script>
<style>
	body {
		background-color: #24242e;
		color: lightgrey;
		font-family: Verdana, Geneva, Tahoma, sans-serif;
	}


	.logger {
		height: 100px;
		font-size: 11px;
		overflow-y: auto;
		cursor: text;
		white-space: pre-wrap;
		background-color: #24242e;
	}

	.line {
		padding: 5px;
		margin-bottom: 5px;
		cursor: pointer;
		color: lightgrey;
	}

	.line:hover {
		background-color: grey;
	}
</style>

<body>
	<div class="container mt-4">
		<p>logger</p>
		<div class="form-control logger" id="logger" readonly></div>
		<div class="d-flex flex-row justify-content-end align-items-center">
			<input type="checkbox" id="enabled"></input>
			<p class="mt-3">start</p>
		</div>
		<hr />
		<p>spammer</p>
		<textarea class="form-control" id="spammer"></textarea>
	</div>
</body>

<script>
	$(document).ready(function ()
	{
		// close existing windows with no parent
		setTimeout(function()
		{
			if (!window.id)
			{
				window.close();
			} else
			{
				console.log(`your parent is ${window.id}`);
			}
		}, 100);
	});

	const { ipcRenderer: ipc } = require("electron");
	const packets = [];

	ipc.on("packet", function(_, packet)
	{
		if ($("#enabled").prop("checked"))
		{
			packets.push(packet);
			update();
		}
	});

	function update()
	{
		const elem = $("#logger");
		elem.html("");

		packets.forEach(function(packet)
		{
			const div = $("<div>").addClass("line").text(packet);
			elem.append(div);
		});
	}
</script>

</html>