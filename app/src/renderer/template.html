<!doctype html>
<html>

<head>
    <script>
        // Dark mode detection - runs before CSS to prevent flash
        (function () {
            const theme = localStorage.getItem('theme');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

            // Apply dark class based on localStorage or system preference
            if (theme === 'dark' || (!theme && systemPrefersDark)) {
                document.documentElement.classList.add('dark');
            }

            // Listen for system preference changes
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                // Only auto-update if user hasn't explicitly set a preference
                if (!localStorage.getItem('theme')) {
                    if (e.matches) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                }
            });

            // Listen for localStorage changes from other windows
            window.addEventListener('storage', (e) => {
                if (e.key === 'theme') {
                    if (e.newValue === 'dark') {
                        document.documentElement.classList.add('dark');
                    } else if (e.newValue === 'light') {
                        document.documentElement.classList.remove('dark');
                    }
                }
            });
        })();

        // Motion preference detection
        (function () {
            const motionPreference = localStorage.getItem('motion');
            const systemPrefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

            // Apply reduce-motion class based on localStorage or system preference
            if (motionPreference === 'reduce' || (!motionPreference && systemPrefersReducedMotion)) {
                document.documentElement.classList.add('reduce-motion');
            }

            // Listen for system preference changes
            window.matchMedia('(prefers-reduced-motion: reduce)').addEventListener('change', (e) => {
                if (!localStorage.getItem('motion')) {
                    if (e.matches) {
                        document.documentElement.classList.add('reduce-motion');
                    } else {
                        document.documentElement.classList.remove('reduce-motion');
                    }
                }
            });

            // Listen for localStorage changes from other windows
            window.addEventListener('storage', (e) => {
                if (e.key === 'motion') {
                    if (e.newValue === 'reduce') {
                        document.documentElement.classList.add('reduce-motion');
                    } else if (e.newValue === 'allow') {
                        document.documentElement.classList.remove('reduce-motion');
                    }
                }
            });
        })();
    </script>
    <link href="{{CSS_PATH}}" rel="stylesheet" />
</head>

<body>
    <script src="{{SCRIPT_PATH}}"></script>
</body>

</html>